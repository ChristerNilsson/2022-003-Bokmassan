// Generated by CoffeeScript 2.5.1
var SEPARATOR, TextDisplay, twSEP;

SEPARATOR = ' • ';

twSEP = 0;

TextDisplay = class TextDisplay {
  constructor(dx, dy, dw1, dh, ts) {
    this.dx = dx;
    this.dy = dy;
    this.dw = dw1;
    this.dh = dh;
    this.ts = ts;
    this.dw = Math.round(this.dw);
    this.dh = Math.round(this.dh);
    this.ts = Math.round(this.ts);
  }

  update(text) {
    var group, i, index, j, k, l, len, len1, n, name, ref, results, summa, w, widths, wx, wy;
    this.text = text;
    if (text.length === 0) {
      this.names = [];
    } else {
      this.names = this.text.split(', ');
    }
    if (this.names.length === 0) {
      this.groups = [];
    }
    if (this.names.length === 1) {
      this.groups = [[0]];
    }
    textSize(this.ts);
    twSEP = textWidth(SEPARATOR);
    widths = this.names.map(function(name, index) {
      return [Math.round(textWidth(name)), index];
    });
    widths.sort();
    widths.reverse();
    summa = 0;
    for (k = 0, len = widths.length; k < len; k++) {
      [w, index] = widths[k];
      summa += w;
    }
    if (summa === 0) {
      return [];
    }
    this.groups = this.gruppera(widths, this.dw);
    this.groups = this.groups.map(function(group) {
      return group.sort();
    });
    this.groups.sort();
    // skapa image med grupperna A, ABA, ABCA...
    n = this.groups.length;
    if (n > 1) {
      n++;
    }
    this.pg = createGraphics(this.dw, this.dh * n);
    this.pg.textSize(this.ts);
    this.pg.background("black");
    this.p = 0;
    ref = range(n);
    results = [];
    for (l = 0, len1 = ref.length; l < len1; l++) {
      i = ref[l];
      group = this.groups[i % this.groups.length];
      wx = 0;
      wy = (i + 0.8) * this.dh;
      results.push((function() {
        var len2, m, ref1, results1;
        ref1 = range(group.length);
        results1 = [];
        for (m = 0, len2 = ref1.length; m < len2; m++) {
          j = ref1[m];
          index = group[j];
          name = this.names[index];
          if (j < group.length - 1) {
            name += SEPARATOR;
          }
          if (index === 0) {
            this.pg.fill('white');
          } else {
            this.pg.fill('gray');
          }
          this.pg.text(name, wx, wy);
          results1.push(wx += this.pg.textWidth(name));
        }
        return results1;
      }).call(this));
    }
    return results;
  }

  draw() {
    var n;
    n = this.groups.length;
    if (n === 0) {
      return;
    }
    if (n <= 2) {
      return image(this.pg, this.dx, this.dy, this.dw, n * this.dh, 0, 0, this.dw, n * this.dh);
    } else {
      image(this.pg, this.dx, this.dy, this.dw, this.dh, 0, Math.round(this.p), this.dw, this.dh);
      return this.p = (this.p + 0.5) % (this.pg.height - this.dh);
    }
  }

  gruppera(widths, dw) {
    var groups, i, index, k, l, last, len, len1, n, ref, ref1, w;
    // prova att få in alla i EN grupp.
    // Går inte det, öka antal grupper
    n = 1;
    while (true) {
      groups = [];
      ref = range(n);
      for (k = 0, len = ref.length; k < len; k++) {
        i = ref[k];
        groups.push([0, []]); // total bredd, indexes
      }
      ref1 = range(widths.length);
      for (l = 0, len1 = ref1.length; l < len1; l++) {
        i = ref1[l];
        [w, index] = widths[i];
        groups[0][0] += w; // bredderna
        groups[0][1].push(index); // indexen
        groups.sort(); // sortera på bredd
      }
      last = groups[groups.length - 1];
      if (last[0] + (last[1].length - 1) * twSEP <= dw) {
        return groups.map(function(group) {
          return group[1];
        });
      }
      n++;
    }
  }

};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGV4dFNjcm9sbGVyLmpzIiwic291cmNlUm9vdCI6Ii4uIiwic291cmNlcyI6WyJjb2ZmZWVcXFRleHRTY3JvbGxlci5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLElBQUEsU0FBQSxFQUFBLFdBQUEsRUFBQTs7QUFBQSxTQUFBLEdBQVk7O0FBQ1osS0FBQSxHQUFROztBQUVGLGNBQU4sTUFBQSxZQUFBO0VBQ0MsV0FBYyxHQUFBLElBQUEsS0FBQSxJQUFBLElBQUEsQ0FBQTtJQUFDLElBQUMsQ0FBQTtJQUFHLElBQUMsQ0FBQTtJQUFHLElBQUMsQ0FBQTtJQUFHLElBQUMsQ0FBQTtJQUFHLElBQUMsQ0FBQTtJQUMvQixJQUFDLENBQUEsRUFBRCxHQUFNLElBQUksQ0FBQyxLQUFMLENBQVcsSUFBQyxDQUFBLEVBQVo7SUFDTixJQUFDLENBQUEsRUFBRCxHQUFNLElBQUksQ0FBQyxLQUFMLENBQVcsSUFBQyxDQUFBLEVBQVo7SUFDTixJQUFDLENBQUEsRUFBRCxHQUFNLElBQUksQ0FBQyxLQUFMLENBQVcsSUFBQyxDQUFBLEVBQVo7RUFITzs7RUFLZCxNQUFTLENBQUMsSUFBRCxDQUFBO0FBQ1YsUUFBQSxLQUFBLEVBQUEsQ0FBQSxFQUFBLEtBQUEsRUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLENBQUEsRUFBQSxHQUFBLEVBQUEsSUFBQSxFQUFBLENBQUEsRUFBQSxJQUFBLEVBQUEsR0FBQSxFQUFBLE9BQUEsRUFBQSxLQUFBLEVBQUEsQ0FBQSxFQUFBLE1BQUEsRUFBQSxFQUFBLEVBQUE7SUFBRSxJQUFDLENBQUEsSUFBRCxHQUFRO0lBQ1IsSUFBRyxJQUFJLENBQUMsTUFBTCxLQUFhLENBQWhCO01BQ0MsSUFBQyxDQUFBLEtBQUQsR0FBUyxHQURWO0tBQUEsTUFBQTtNQUdDLElBQUMsQ0FBQSxLQUFELEdBQVMsSUFBQyxDQUFBLElBQUksQ0FBQyxLQUFOLENBQVksSUFBWixFQUhWOztJQUlBLElBQUcsSUFBQyxDQUFBLEtBQUssQ0FBQyxN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QU0sQ0FBQyxDQUFELENBQUcsQ0FBQyxDQUFELENBQVQsSUFBZ0IsRUFEcEI7UUFFSSxNQUFNLENBQUMsQ0FBRCxDQUFHLENBQUMsQ0FBRCxDQUFHLENBQUMsSUFBYixDQUFrQixLQUFsQixFQUZKO1FBR0ksTUFBTSxDQUFDLElBQVAsQ0FBQSxFQUpEO01BQUE7TUFLQSxJQUFBLEdBQU8sTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFQLEdBQWMsQ0FBZjtNQUNiLElBQUcsSUFBSSxDQUFDLENBQUQsQ0FBSixHQUFVLENBQUMsSUFBSSxDQUFDLENBQUQsQ0FBRyxDQUFDLE1BQVIsR0FBZSxDQUFoQixDQUFBLEdBQXFCLEtBQS9CLElBQXdDLEVBQTNDO0FBQ0MsZUFBTyxNQUFNLENBQUMsR0FBUCxDQUFXLFFBQUEsQ0FBQyxLQUFELENBQUE7aUJBQVcsS0FBSyxDQUFDLENBQUQ7UUFBaEIsQ0FBWCxFQURSOztNQUVBLENBQUE7SUFaRDtFQUpVOztBQXZEWiIsInNvdXJjZXNDb250ZW50IjpbIlNFUEFSQVRPUiA9ICcg4oCiICdcclxudHdTRVAgPSAwXHJcblxyXG5jbGFzcyBUZXh0RGlzcGxheVxyXG5cdGNvbnN0cnVjdG9yIDogKEBkeCxAZHksQGR3LEBkaCxAdHMpIC0+XHJcblx0XHRAZHcgPSBNYXRoLnJvdW5kIEBkd1xyXG5cdFx0QGRoID0gTWF0aC5yb3VuZCBAZGhcclxuXHRcdEB0cyA9IE1hdGgucm91bmQgQHRzXHJcblxyXG5cdHVwZGF0ZSA6ICh0ZXh0KSAtPlxyXG5cdFx0QHRleHQgPSB0ZXh0XHJcblx0XHRpZiB0ZXh0Lmxlbmd0aD09MCBcclxuXHRcdFx0QG5hbWVzID0gW11cclxuXHRcdGVsc2VcclxuXHRcdFx0QG5hbWVzID0gQHRleHQuc3BsaXQgJywgJ1xyXG5cdFx0aWYgQG5hbWVzLmxlbmd0aCA9PSAwIHRoZW4gQGdyb3VwcyA9IFtdXHJcblx0XHRpZiBAbmFtZXMubGVuZ3RoID09IDEgdGhlbiBAZ3JvdXBzID0gW1swXV1cclxuXHRcdHRleHRTaXplIEB0c1xyXG5cdFx0dHdTRVAgPSB0ZXh0V2lkdGggU0VQQVJBVE9SXHJcblx0XHR3aWR0aHMgPSBAbmFtZXMubWFwIChuYW1lLGluZGV4KSAtPiBbTWF0aC5yb3VuZCh0ZXh0V2lkdGgobmFtZSkpLGluZGV4XVxyXG5cdFx0d2lkdGhzLnNvcnQoKVxyXG5cdFx0d2lkdGhzLnJldmVyc2UoKVxyXG5cdFx0c3VtbWEgPSAwXHJcblx0XHRmb3IgW3csaW5kZXhdIGluIHdpZHRoc1xyXG5cdFx0XHRzdW1tYSArPSB3XHJcblx0XHRpZiBzdW1tYSA9PSAwIHRoZW4gcmV0dXJuIFtdXHJcblx0XHRAZ3JvdXBzID0gQGdydXBwZXJhIHdpZHRocyxAZHdcclxuXHRcdEBncm91cHMgPSBAZ3JvdXBzLm1hcCAoZ3JvdXApIC0+IGdyb3VwLnNvcnQoKVxyXG5cdFx0QGdyb3Vwcy5zb3J0KClcclxuXHJcblx0XHQjIHNrYXBhIGltYWdlIG1lZCBncnVwcGVybmEgQSwgQUJBLCBBQkNBLi4uXHJcblx0XHRuID0gQGdyb3Vwcy5sZW5ndGhcclxuXHRcdGlmIG4gPiAxIHRoZW4gbisrIFxyXG5cdFx0QHBnID0gY3JlYXRlR3JhcGhpY3MgQGR3LCBAZGggKiBuXHJcblx0XHRAcGcudGV4dFNpemUgQHRzXHJcblx0XHRAcGcuYmFja2dyb3VuZCBcImJsYWNrXCJcclxuXHRcdEBwID0gMFxyXG5cdFx0Zm9yIGkgaW4gcmFuZ2UgblxyXG5cdFx0XHRncm91cCA9IEBncm91cHNbaSAlIEBncm91cHMubGVuZ3RoXVxyXG5cdFx0XHR3eCA9IDBcclxuXHRcdFx0d3kgPSAoaSArIDAuOCkgKiBAZGhcclxuXHRcdFx0Zm9yIGogaW4gcmFuZ2UgZ3JvdXAubGVuZ3RoIFxyXG5cdFx0XHRcdGluZGV4ID0gZ3JvdXBbal1cclxuXHRcdFx0XHRuYW1lID0gQG5hbWVzW2luZGV4XVxyXG5cdFx0XHRcdGlmIGogPCBncm91cC5sZW5ndGgtMSB0aGVuIG5hbWUgKz0gU0VQQVJBVE9SXHJcblx0XHRcdFx0aWYgaW5kZXggPT0gMCB0aGVuIEBwZy5maWxsICd3aGl0ZScgZWxzZSBAcGcuZmlsbCAnZ3JheSdcclxuXHRcdFx0XHRAcGcudGV4dCBuYW1lLCB3eCx3eVxyXG5cdFx0XHRcdHd4ICs9IEBwZy50ZXh0V2lkdGggbmFtZVxyXG5cclxuXHRkcmF3IDogKCkgLT5cclxuXHRcdG4gPSBAZ3JvdXBzLmxlbmd0aFxyXG5cdFx0aWYgbiA9PSAwIHRoZW4gcmV0dXJuXHJcblx0XHRpZiBuIDw9IDJcclxuXHRcdFx0aW1hZ2UgQHBnLCBAZHgsQGR5LEBkdyxuKkBkaCwgMCwwLEBkdyxuKkBkaFxyXG5cdFx0ZWxzZVxyXG5cdFx0XHRpbWFnZSBAcGcsIEBkeCxAZHksQGR3LEBkaCwgMCxNYXRoLnJvdW5kKEBwKSxAZHcsQGRoXHJcblx0XHRcdEBwID0gKEBwKzAuNSkgJSAoQHBnLmhlaWdodC1AZGgpXHJcblxyXG5cdGdydXBwZXJhIDogKHdpZHRocyxkdykgLT5cclxuXHRcdCMgcHJvdmEgYXR0IGbDpSBpbiBhbGxhIGkgRU4gZ3J1cHAuXHJcblx0XHQjIEfDpXIgaW50ZSBkZXQsIMO2a2EgYW50YWwgZ3J1cHBlclxyXG5cdFx0biA9IDFcclxuXHRcdHdoaWxlIHRydWVcclxuXHRcdFx0Z3JvdXBzID0gW11cclxuXHRcdFx0Zm9yIGkgaW4gcmFuZ2UgbiBcclxuXHRcdFx0XHRncm91cHMucHVzaCBbMCxbXV0gIyB0b3RhbCBicmVkZCwgaW5kZXhlc1xyXG5cdFx0XHRmb3IgaSBpbiByYW5nZSB3aWR0aHMubGVuZ3RoIFxyXG5cdFx0XHRcdFt3LGluZGV4XSA9IHdpZHRoc1tpXVxyXG5cdFx0XHRcdGdyb3Vwc1swXVswXSArPSB3ICMgYnJlZGRlcm5hXHJcblx0XHRcdFx0Z3JvdXBzWzBdWzFdLnB1c2ggaW5kZXggIyBpbmRleGVuXHJcblx0XHRcdFx0Z3JvdXBzLnNvcnQoKSAjIHNvcnRlcmEgcMOlIGJyZWRkXHJcblx0XHRcdGxhc3QgPSBncm91cHNbZ3JvdXBzLmxlbmd0aC0xXSAjIGJyZWRhc3RlIGdydXBwZW5cclxuXHRcdFx0aWYgbGFzdFswXSArIChsYXN0WzFdLmxlbmd0aC0xKSAqIHR3U0VQIDw9IGR3XHJcblx0XHRcdFx0cmV0dXJuIGdyb3Vwcy5tYXAgKGdyb3VwKSAtPiBncm91cFsxXSAjIHNraXBwYSBicmVkZGVybmFcclxuXHRcdFx0bisrXHJcbiJdfQ==
//# sourceURL=c:\github\2022-003-Bokmassan\coffee\TextScroller.coffee