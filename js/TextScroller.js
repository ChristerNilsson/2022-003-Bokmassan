// Generated by CoffeeScript 2.5.1
var SEPARATOR, TextDisplay, twSEP;

SEPARATOR = ' • ';

twSEP = 0;

TextDisplay = class TextDisplay {
  constructor(dx, dy, dw1, dh, ts) {
    this.dx = dx;
    this.dy = dy;
    this.dw = dw1;
    this.dh = dh;
    this.ts = ts;
    this.dw = Math.round(this.dw);
    this.dh = Math.round(this.dh);
    this.ts = Math.round(this.ts);
    this.pg = createGraphics(this.dw, this.dh * 5); // Klarar ABCAB
  }

  update(text) {
    var group, i, index, j, k, l, len, len1, n, name, ref, results, summa, w, widths, wx, wy;
    this.text = text;
    this.names = text.length === 0 ? [] : this.text.split(', ');
    if (this.names.length === 0) {
      this.groups = [];
    }
    if (this.names.length === 1) {
      this.groups = [[0]];
    }
    textSize(this.ts);
    twSEP = textWidth(SEPARATOR);
    widths = this.names.map(function(name, index) {
      return [Math.round(textWidth(name)), index];
    });
    widths.sort();
    widths.reverse();
    summa = 0;
    for (k = 0, len = widths.length; k < len; k++) {
      [w, index] = widths[k];
      summa += w;
    }
    if (summa === 0) {
      return [];
    }
    this.groups = this.gruppera(widths, this.dw);
    this.groups = this.groups.map(function(group) {
      return group.sort();
    });
    this.groups.sort();
    // skapa image med grupperna A, AB, ABCAB, ABCDAB
    n = this.groups.length;
    if (n < 2) {
      n += 1;
    } else {
      n += 2;
    }
    this.pg.textSize(this.ts);
    this.pg.background("black");
    this.p = 0;
    ref = range(n);
    results = [];
    for (l = 0, len1 = ref.length; l < len1; l++) {
      i = ref[l];
      group = this.groups[i % this.groups.length];
      wx = 0;
      wy = (i + 0.8) * this.dh;
      results.push((function() {
        var len2, m, ref1, results1;
        ref1 = range(group.length);
        results1 = [];
        for (m = 0, len2 = ref1.length; m < len2; m++) {
          j = ref1[m];
          index = group[j];
          name = this.names[index];
          if (j < group.length - 1) {
            name += SEPARATOR;
          }
          this.pg.fill(index === 0 ? 'white' : 'gray');
          this.pg.text(name, wx, wy);
          results1.push(wx += this.pg.textWidth(name));
        }
        return results1;
      }).call(this));
    }
    return results;
  }

  draw() {
    var n;
    n = this.groups.length;
    if (n === 0) {
      return;
    }
    if (n <= 2) {
      return image(this.pg, this.dx, this.dy, this.dw, n * this.dh, 0, 0, this.dw, n * this.dh);
    } else {
      image(this.pg, this.dx, this.dy, this.dw, 2 * this.dh, 0, Math.round(this.p), this.dw, 2 * this.dh);
      return this.p = (this.p + 0.25) % (this.pg.height - 2 * this.dh);
    }
  }

  gruppera(widths, dw) {
    var groups, i, index, k, l, last, len, len1, n, ref, ref1, w;
    // prova att få in alla i EN grupp.
    // Går inte det, öka antal grupper
    n = 1;
    while (true) {
      groups = [];
      ref = range(n);
      for (k = 0, len = ref.length; k < len; k++) {
        i = ref[k];
        groups.push([0, []]); // total bredd, indexes
      }
      ref1 = range(widths.length);
      for (l = 0, len1 = ref1.length; l < len1; l++) {
        i = ref1[l];
        [w, index] = widths[i];
        groups[0][0] += w; // bredderna
        groups[0][1].push(index); // indexen
        groups.sort(); // sortera på bredd
      }
      last = groups[groups.length - 1];
      if (last[0] + (last[1].length - 1) * twSEP <= dw) {
        return groups.map(function(group) {
          return group[1];
        });
      }
      n++;
    }
  }

};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGV4dFNjcm9sbGVyLmpzIiwic291cmNlUm9vdCI6Ii4uIiwic291cmNlcyI6WyJjb2ZmZWVcXFRleHRTY3JvbGxlci5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLElBQUEsU0FBQSxFQUFBLFdBQUEsRUFBQTs7QUFBQSxTQUFBLEdBQVk7O0FBQ1osS0FBQSxHQUFROztBQUVGLGNBQU4sTUFBQSxZQUFBO0VBQ0MsV0FBYyxHQUFBLElBQUEsS0FBQSxJQUFBLElBQUEsQ0FBQTtJQUFDLElBQUMsQ0FBQTtJQUFHLElBQUMsQ0FBQTtJQUFHLElBQUMsQ0FBQTtJQUFHLElBQUMsQ0FBQTtJQUFHLElBQUMsQ0FBQTtJQUMvQixJQUFDLENBQUEsRUFBRCxHQUFNLElBQUksQ0FBQyxLQUFMLENBQVcsSUFBQyxDQUFBLEVBQVo7SUFDTixJQUFDLENBQUEsRUFBRCxHQUFNLElBQUksQ0FBQyxLQUFMLENBQVcsSUFBQyxDQUFBLEVBQVo7SUFDTixJQUFDLENBQUEsRUFBRCxHQUFNLElBQUksQ0FBQyxLQUFMLENBQVcsSUFBQyxDQUFBLEVBQVo7SUFDTixJQUFDLENBQUEsRUFBRCxHQUFNLGNBQUEsQ0FBZSxJQUFDLENBQUEsRUFBaEIsRUFBb0IsSUFBQyxDQUFBLEVBQUQsR0FBTSxDQUExQixFQUpPO0VBQUE7O0VBTWQsTUFBUyxDQUFDLElBQUQsQ0FBQTtBQUNWLFFBQUEsS0FBQSxFQUFBLENBQUEsRUFBQSxLQUFBLEVBQUEsQ0FBQSxFQUFBLENBQUEsRUFBQSxDQUFBLEVBQUEsR0FBQSxFQUFBLElBQUEsRUFBQSxDQUFBLEVBQUEsSUFBQSxFQUFBLEdBQUEsRUFBQSxPQUFBLEVBQUEsS0FBQSxFQUFBLENBQUEsRUFBQSxNQUFBLEVBQUEsRUFBQSxFQUFBO0lBQUUsSUFBQyxDQUFBLElBQUQsR0FBUTtJQUNSLElBQUMsQ0FBQSxLQUFELEdBQVksSUFBSSxDQUFDLE1BQUwsS0FBYSxDQUFoQixHQUF1QixFQUF2QixHQUErQixJQUFDLENBQUEsSUFBSSxD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QyxDQUFELENBQVQsSUFBZ0IsRUFEcEI7UUFFSSxNQUFNLENBQUMsQ0FBRCxDQUFHLENBQUMsQ0FBRCxDQUFHLENBQUMsSUFBYixDQUFrQixLQUFsQixFQUZKO1FBR0ksTUFBTSxDQUFDLElBQVAsQ0FBQSxFQUpEO01BQUE7TUFLQSxJQUFBLEdBQU8sTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFQLEdBQWMsQ0FBZjtNQUNiLElBQUcsSUFBSSxDQUFDLENBQUQsQ0FBSixHQUFVLENBQUMsSUFBSSxDQUFDLENBQUQsQ0FBRyxDQUFDLE1BQVIsR0FBZSxDQUFoQixDQUFBLEdBQXFCLEtBQS9CLElBQXdDLEVBQTNDO0FBQ0MsZUFBTyxNQUFNLENBQUMsR0FBUCxDQUFXLFFBQUEsQ0FBQyxLQUFELENBQUE7aUJBQVcsS0FBSyxDQUFDLENBQUQ7UUFBaEIsQ0FBWCxFQURSOztNQUVBLENBQUE7SUFaRDtFQUpVOztBQXBEWiIsInNvdXJjZXNDb250ZW50IjpbIlNFUEFSQVRPUiA9ICcg4oCiICdcclxudHdTRVAgPSAwXHJcblxyXG5jbGFzcyBUZXh0RGlzcGxheVxyXG5cdGNvbnN0cnVjdG9yIDogKEBkeCxAZHksQGR3LEBkaCxAdHMpIC0+XHJcblx0XHRAZHcgPSBNYXRoLnJvdW5kIEBkd1xyXG5cdFx0QGRoID0gTWF0aC5yb3VuZCBAZGhcclxuXHRcdEB0cyA9IE1hdGgucm91bmQgQHRzXHJcblx0XHRAcGcgPSBjcmVhdGVHcmFwaGljcyBAZHcsIEBkaCAqIDUgIyBLbGFyYXIgQUJDQUJcclxuXHJcblx0dXBkYXRlIDogKHRleHQpIC0+XHJcblx0XHRAdGV4dCA9IHRleHRcclxuXHRcdEBuYW1lcyA9IGlmIHRleHQubGVuZ3RoPT0wIHRoZW4gW10gZWxzZSBAdGV4dC5zcGxpdCAnLCAnXHJcblx0XHRpZiBAbmFtZXMubGVuZ3RoID09IDAgdGhlbiBAZ3JvdXBzID0gW11cclxuXHRcdGlmIEBuYW1lcy5sZW5ndGggPT0gMSB0aGVuIEBncm91cHMgPSBbWzBdXVxyXG5cdFx0dGV4dFNpemUgQHRzXHJcblx0XHR0d1NFUCA9IHRleHRXaWR0aCBTRVBBUkFUT1JcclxuXHRcdHdpZHRocyA9IEBuYW1lcy5tYXAgKG5hbWUsaW5kZXgpIC0+IFtNYXRoLnJvdW5kKHRleHRXaWR0aChuYW1lKSksaW5kZXhdXHJcblx0XHR3aWR0aHMuc29ydCgpXHJcblx0XHR3aWR0aHMucmV2ZXJzZSgpXHJcblx0XHRzdW1tYSA9IDBcclxuXHRcdGZvciBbdyxpbmRleF0gaW4gd2lkdGhzXHJcblx0XHRcdHN1bW1hICs9IHdcclxuXHRcdGlmIHN1bW1hID09IDAgdGhlbiByZXR1cm4gW11cclxuXHRcdEBncm91cHMgPSBAZ3J1cHBlcmEgd2lkdGhzLEBkd1xyXG5cdFx0QGdyb3VwcyA9IEBncm91cHMubWFwIChncm91cCkgLT4gZ3JvdXAuc29ydCgpXHJcblx0XHRAZ3JvdXBzLnNvcnQoKVxyXG5cclxuXHRcdCMgc2thcGEgaW1hZ2UgbWVkIGdydXBwZXJuYSBBLCBBQiwgQUJDQUIsIEFCQ0RBQlxyXG5cdFx0biA9IEBncm91cHMubGVuZ3RoXHJcblx0XHRpZiBuIDwgMiB0aGVuIG4rPTEgZWxzZSBuKz0yXHJcblx0XHRAcGcudGV4dFNpemUgQHRzXHJcblx0XHRAcGcuYmFja2dyb3VuZCBcImJsYWNrXCJcclxuXHRcdEBwID0gMFxyXG5cdFx0Zm9yIGkgaW4gcmFuZ2UgblxyXG5cdFx0XHRncm91cCA9IEBncm91cHNbaSAlIEBncm91cHMubGVuZ3RoXVxyXG5cdFx0XHR3eCA9IDBcclxuXHRcdFx0d3kgPSAoaSArIDAuOCkgKiBAZGhcclxuXHRcdFx0Zm9yIGogaW4gcmFuZ2UgZ3JvdXAubGVuZ3RoIFxyXG5cdFx0XHRcdGluZGV4ID0gZ3JvdXBbal1cclxuXHRcdFx0XHRuYW1lID0gQG5hbWVzW2luZGV4XVxyXG5cdFx0XHRcdGlmIGogPCBncm91cC5sZW5ndGgtMSB0aGVuIG5hbWUgKz0gU0VQQVJBVE9SXHJcblx0XHRcdFx0QHBnLmZpbGwgaWYgaW5kZXggPT0gMCB0aGVuICd3aGl0ZScgZWxzZSAnZ3JheSdcclxuXHRcdFx0XHRAcGcudGV4dCBuYW1lLCB3eCx3eVxyXG5cdFx0XHRcdHd4ICs9IEBwZy50ZXh0V2lkdGggbmFtZVxyXG5cclxuXHRkcmF3IDogKCkgLT5cclxuXHRcdG4gPSBAZ3JvdXBzLmxlbmd0aFxyXG5cdFx0aWYgbiA9PSAwIHRoZW4gcmV0dXJuXHJcblx0XHRpZiBuIDw9IDJcclxuXHRcdFx0aW1hZ2UgQHBnLCBAZHgsQGR5LEBkdyxuKkBkaCwgMCwwLEBkdyxuKkBkaFxyXG5cdFx0ZWxzZVxyXG5cdFx0XHRpbWFnZSBAcGcsIEBkeCxAZHksQGR3LDIqQGRoLCAwLE1hdGgucm91bmQoQHApLEBkdywyKkBkaFxyXG5cdFx0XHRAcCA9IChAcCswLjI1KSAlIChAcGcuaGVpZ2h0LTIqQGRoKVxyXG5cclxuXHRncnVwcGVyYSA6ICh3aWR0aHMsZHcpIC0+XHJcblx0XHQjIHByb3ZhIGF0dCBmw6UgaW4gYWxsYSBpIEVOIGdydXBwLlxyXG5cdFx0IyBHw6VyIGludGUgZGV0LCDDtmthIGFudGFsIGdydXBwZXJcclxuXHRcdG4gPSAxXHJcblx0XHR3aGlsZSB0cnVlXHJcblx0XHRcdGdyb3VwcyA9IFtdXHJcblx0XHRcdGZvciBpIGluIHJhbmdlIG4gXHJcblx0XHRcdFx0Z3JvdXBzLnB1c2ggWzAsW11dICMgdG90YWwgYnJlZGQsIGluZGV4ZXNcclxuXHRcdFx0Zm9yIGkgaW4gcmFuZ2Ugd2lkdGhzLmxlbmd0aCBcclxuXHRcdFx0XHRbdyxpbmRleF0gPSB3aWR0aHNbaV1cclxuXHRcdFx0XHRncm91cHNbMF1bMF0gKz0gdyAjIGJyZWRkZXJuYVxyXG5cdFx0XHRcdGdyb3Vwc1swXVsxXS5wdXNoIGluZGV4ICMgaW5kZXhlblxyXG5cdFx0XHRcdGdyb3Vwcy5zb3J0KCkgIyBzb3J0ZXJhIHDDpSBicmVkZFxyXG5cdFx0XHRsYXN0ID0gZ3JvdXBzW2dyb3Vwcy5sZW5ndGgtMV0gIyBicmVkYXN0ZSBncnVwcGVuXHJcblx0XHRcdGlmIGxhc3RbMF0gKyAobGFzdFsxXS5sZW5ndGgtMSkgKiB0d1NFUCA8PSBkd1xyXG5cdFx0XHRcdHJldHVybiBncm91cHMubWFwIChncm91cCkgLT4gZ3JvdXBbMV0gIyBza2lwcGEgYnJlZGRlcm5hXHJcblx0XHRcdG4rK1xyXG4iXX0=
//# sourceURL=c:\github\2022-003-Bokmassan\coffee\TextScroller.coffee