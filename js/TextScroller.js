// Generated by CoffeeScript 2.5.1
var SEPARATOR, TextDisplay, twSEP;

SEPARATOR = ' • ';

twSEP = 0;

TextDisplay = class TextDisplay {
  constructor(dx, dy, dw1, dh, ts) {
    this.dx = dx;
    this.dy = dy;
    this.dw = dw1;
    this.dh = dh;
    this.ts = ts;
    this.dw = Math.round(this.dw);
    this.dh = Math.round(this.dh);
    this.ts = Math.round(this.ts);
  }

  update(text) {
    var group, i, index, j, k, l, len, len1, n, name, ref, results, summa, w, widths, wx, wy;
    this.text = text;
    if (text.length === 0) {
      this.names = [];
    } else {
      this.names = this.text.split(', ');
    }
    if (this.names.length === 0) {
      this.groups = [];
    }
    if (this.names.length === 1) {
      this.groups = [[0]];
    }
    textSize(this.ts);
    twSEP = textWidth(SEPARATOR);
    widths = this.names.map(function(name, index) {
      return [Math.round(textWidth(name)), index];
    });
    widths.sort();
    widths.reverse();
    summa = 0;
    for (k = 0, len = widths.length; k < len; k++) {
      [w, index] = widths[k];
      summa += w;
    }
    if (summa === 0) {
      return [];
    }
    this.groups = this.gruppera(widths, this.dw);
    this.groups = this.groups.map(function(group) {
      return group.sort();
    });
    this.groups.sort();
    // skapa image med grupperna A, ABA, ABCAB, ABCDAB
    n = this.groups.length;
    if (n < 2) {
      n++;
    } else {
      n += 2;
    }
    this.pg = createGraphics(this.dw, this.dh * n);
    this.pg.textSize(this.ts);
    this.pg.background("black");
    this.p = 0;
    ref = range(n);
    results = [];
    for (l = 0, len1 = ref.length; l < len1; l++) {
      i = ref[l];
      group = this.groups[i % this.groups.length];
      wx = 0;
      wy = (i + 0.8) * this.dh;
      results.push((function() {
        var len2, m, ref1, results1;
        ref1 = range(group.length);
        results1 = [];
        for (m = 0, len2 = ref1.length; m < len2; m++) {
          j = ref1[m];
          index = group[j];
          name = this.names[index];
          if (j < group.length - 1) {
            name += SEPARATOR;
          }
          if (index === 0) {
            this.pg.fill('white');
          } else {
            this.pg.fill('gray');
          }
          this.pg.text(name, wx, wy);
          results1.push(wx += this.pg.textWidth(name));
        }
        return results1;
      }).call(this));
    }
    return results;
  }

  draw() {
    var n;
    n = this.groups.length;
    if (n === 0) {
      return;
    }
    if (n <= 2) {
      return image(this.pg, this.dx, this.dy, this.dw, n * this.dh, 0, 0, this.dw, n * this.dh);
    } else {
      image(this.pg, this.dx, this.dy, this.dw, 2 * this.dh, 0, Math.round(this.p), this.dw, 2 * this.dh);
      return this.p = (this.p + 0.25) % (this.pg.height - 2 * this.dh);
    }
  }

  gruppera(widths, dw) {
    var groups, i, index, k, l, last, len, len1, n, ref, ref1, w;
    // prova att få in alla i EN grupp.
    // Går inte det, öka antal grupper
    n = 1;
    while (true) {
      groups = [];
      ref = range(n);
      for (k = 0, len = ref.length; k < len; k++) {
        i = ref[k];
        groups.push([0, []]); // total bredd, indexes
      }
      ref1 = range(widths.length);
      for (l = 0, len1 = ref1.length; l < len1; l++) {
        i = ref1[l];
        [w, index] = widths[i];
        groups[0][0] += w; // bredderna
        groups[0][1].push(index); // indexen
        groups.sort(); // sortera på bredd
      }
      last = groups[groups.length - 1];
      if (last[0] + (last[1].length - 1) * twSEP <= dw) {
        return groups.map(function(group) {
          return group[1];
        });
      }
      n++;
    }
  }

};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGV4dFNjcm9sbGVyLmpzIiwic291cmNlUm9vdCI6Ii4uIiwic291cmNlcyI6WyJjb2ZmZWVcXFRleHRTY3JvbGxlci5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLElBQUEsU0FBQSxFQUFBLFdBQUEsRUFBQTs7QUFBQSxTQUFBLEdBQVk7O0FBQ1osS0FBQSxHQUFROztBQUVGLGNBQU4sTUFBQSxZQUFBO0VBQ0MsV0FBYyxHQUFBLElBQUEsS0FBQSxJQUFBLElBQUEsQ0FBQTtJQUFDLElBQUMsQ0FBQTtJQUFHLElBQUMsQ0FBQTtJQUFHLElBQUMsQ0FBQTtJQUFHLElBQUMsQ0FBQTtJQUFHLElBQUMsQ0FBQTtJQUMvQixJQUFDLENBQUEsRUFBRCxHQUFNLElBQUksQ0FBQyxLQUFMLENBQVcsSUFBQyxDQUFBLEVBQVo7SUFDTixJQUFDLENBQUEsRUFBRCxHQUFNLElBQUksQ0FBQyxLQUFMLENBQVcsSUFBQyxDQUFBLEVBQVo7SUFDTixJQUFDLENBQUEsRUFBRCxHQUFNLElBQUksQ0FBQyxLQUFMLENBQVcsSUFBQyxDQUFBLEVBQVo7RUFITzs7RUFLZCxNQUFTLENBQUMsSUFBRCxDQUFBO0FBQ1YsUUFBQSxLQUFBLEVBQUEsQ0FBQSxFQUFBLEtBQUEsRUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLENBQUEsRUFBQSxHQUFBLEVBQUEsSUFBQSxFQUFBLENBQUEsRUFBQSxJQUFBLEVBQUEsR0FBQSxFQUFBLE9BQUEsRUFBQSxLQUFBLEVBQUEsQ0FBQSxFQUFBLE1BQUEsRUFBQSxFQUFBLEVBQUE7SUFBRSxJQUFDLENBQUEsSUFBRCxHQUFRO0lBQ1IsSUFBRyxJQUFJLENBQUMsTUFBTCxLQUFhLENBQWhCO01BQ0MsSUFBQyxDQUFBLEtBQUQsR0FBUyxHQURWO0tBQUEsTUFBQTtNQUdDLElBQUMsQ0FBQSxLQUFELEdBQVMsSUFBQyxDQUFBLElBQUksQ0FBQyxLQUFOLENBQVksSUFBWixFQUhWOztJQUlBLElBQUcsSUFBQyxDQUFBLEtBQUssQ0FBQyxN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QUE7O1FBQ0MsQ0FBQyxDQUFELEVBQUcsS0FBSCxDQUFBLEdBQVksTUFBTSxDQUFDLENBQUQ7UUFDbEIsTUFBTSxDQUFDLENBQUQsQ0FBRyxDQUFDLENBQUQsQ0FBVCxJQUFnQixFQURwQjtRQUVJLE1BQU0sQ0FBQyxDQUFELENBQUcsQ0FBQyxDQUFELENBQUcsQ0FBQyxJQUFiLENBQWtCLEtBQWxCLEVBRko7UUFHSSxNQUFNLENBQUMsSUFBUCxDQUFBLEVBSkQ7TUFBQTtNQUtBLElBQUEsR0FBTyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQVAsR0FBYyxDQUFmO01BQ2IsSUFBRyxJQUFJLENBQUMsQ0FBRCxDQUFKLEdBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBRCxDQUFHLENBQUMsTUFBUixHQUFlLENBQWhCLENBQUEsR0FBcUIsS0FBL0IsSUFBd0MsRUFBM0M7QUFDQyxlQUFPLE1BQU0sQ0FBQyxHQUFQLENBQVcsUUFBQSxDQUFDLEtBQUQsQ0FBQTtpQkFBVyxLQUFLLENBQUMsQ0FBRDtRQUFoQixDQUFYLEVBRFI7O01BRUEsQ0FBQTtJQVpEO0VBSlU7O0FBdkRaIiwic291cmNlc0NvbnRlbnQiOlsiU0VQQVJBVE9SID0gJyDigKIgJ1xyXG50d1NFUCA9IDBcclxuXHJcbmNsYXNzIFRleHREaXNwbGF5XHJcblx0Y29uc3RydWN0b3IgOiAoQGR4LEBkeSxAZHcsQGRoLEB0cykgLT5cclxuXHRcdEBkdyA9IE1hdGgucm91bmQgQGR3XHJcblx0XHRAZGggPSBNYXRoLnJvdW5kIEBkaFxyXG5cdFx0QHRzID0gTWF0aC5yb3VuZCBAdHNcclxuXHJcblx0dXBkYXRlIDogKHRleHQpIC0+XHJcblx0XHRAdGV4dCA9IHRleHRcclxuXHRcdGlmIHRleHQubGVuZ3RoPT0wIFxyXG5cdFx0XHRAbmFtZXMgPSBbXVxyXG5cdFx0ZWxzZVxyXG5cdFx0XHRAbmFtZXMgPSBAdGV4dC5zcGxpdCAnLCAnXHJcblx0XHRpZiBAbmFtZXMubGVuZ3RoID09IDAgdGhlbiBAZ3JvdXBzID0gW11cclxuXHRcdGlmIEBuYW1lcy5sZW5ndGggPT0gMSB0aGVuIEBncm91cHMgPSBbWzBdXVxyXG5cdFx0dGV4dFNpemUgQHRzXHJcblx0XHR0d1NFUCA9IHRleHRXaWR0aCBTRVBBUkFUT1JcclxuXHRcdHdpZHRocyA9IEBuYW1lcy5tYXAgKG5hbWUsaW5kZXgpIC0+IFtNYXRoLnJvdW5kKHRleHRXaWR0aChuYW1lKSksaW5kZXhdXHJcblx0XHR3aWR0aHMuc29ydCgpXHJcblx0XHR3aWR0aHMucmV2ZXJzZSgpXHJcblx0XHRzdW1tYSA9IDBcclxuXHRcdGZvciBbdyxpbmRleF0gaW4gd2lkdGhzXHJcblx0XHRcdHN1bW1hICs9IHdcclxuXHRcdGlmIHN1bW1hID09IDAgdGhlbiByZXR1cm4gW11cclxuXHRcdEBncm91cHMgPSBAZ3J1cHBlcmEgd2lkdGhzLEBkd1xyXG5cdFx0QGdyb3VwcyA9IEBncm91cHMubWFwIChncm91cCkgLT4gZ3JvdXAuc29ydCgpXHJcblx0XHRAZ3JvdXBzLnNvcnQoKVxyXG5cclxuXHRcdCMgc2thcGEgaW1hZ2UgbWVkIGdydXBwZXJuYSBBLCBBQkEsIEFCQ0FCLCBBQkNEQUJcclxuXHRcdG4gPSBAZ3JvdXBzLmxlbmd0aFxyXG5cdFx0aWYgbiA8IDIgdGhlbiBuKysgZWxzZSBuKz0yXHJcblx0XHRAcGcgPSBjcmVhdGVHcmFwaGljcyBAZHcsIEBkaCAqIG5cclxuXHRcdEBwZy50ZXh0U2l6ZSBAdHNcclxuXHRcdEBwZy5iYWNrZ3JvdW5kIFwiYmxhY2tcIlxyXG5cdFx0QHAgPSAwXHJcblx0XHRmb3IgaSBpbiByYW5nZSBuXHJcblx0XHRcdGdyb3VwID0gQGdyb3Vwc1tpICUgQGdyb3Vwcy5sZW5ndGhdXHJcblx0XHRcdHd4ID0gMFxyXG5cdFx0XHR3eSA9IChpICsgMC44KSAqIEBkaFxyXG5cdFx0XHRmb3IgaiBpbiByYW5nZSBncm91cC5sZW5ndGggXHJcblx0XHRcdFx0aW5kZXggPSBncm91cFtqXVxyXG5cdFx0XHRcdG5hbWUgPSBAbmFtZXNbaW5kZXhdXHJcblx0XHRcdFx0aWYgaiA8IGdyb3VwLmxlbmd0aC0xIHRoZW4gbmFtZSArPSBTRVBBUkFUT1JcclxuXHRcdFx0XHRpZiBpbmRleCA9PSAwIHRoZW4gQHBnLmZpbGwgJ3doaXRlJyBlbHNlIEBwZy5maWxsICdncmF5J1xyXG5cdFx0XHRcdEBwZy50ZXh0IG5hbWUsIHd4LHd5XHJcblx0XHRcdFx0d3ggKz0gQHBnLnRleHRXaWR0aCBuYW1lXHJcblxyXG5cdGRyYXcgOiAoKSAtPlxyXG5cdFx0biA9IEBncm91cHMubGVuZ3RoXHJcblx0XHRpZiBuID09IDAgdGhlbiByZXR1cm5cclxuXHRcdGlmIG4gPD0gMlxyXG5cdFx0XHRpbWFnZSBAcGcsIEBkeCxAZHksQGR3LG4qQGRoLCAwLDAsQGR3LG4qQGRoXHJcblx0XHRlbHNlXHJcblx0XHRcdGltYWdlIEBwZywgQGR4LEBkeSxAZHcsMipAZGgsIDAsTWF0aC5yb3VuZChAcCksQGR3LDIqQGRoXHJcblx0XHRcdEBwID0gKEBwKzAuMjUpICUgKEBwZy5oZWlnaHQtMipAZGgpXHJcblxyXG5cdGdydXBwZXJhIDogKHdpZHRocyxkdykgLT5cclxuXHRcdCMgcHJvdmEgYXR0IGbDpSBpbiBhbGxhIGkgRU4gZ3J1cHAuXHJcblx0XHQjIEfDpXIgaW50ZSBkZXQsIMO2a2EgYW50YWwgZ3J1cHBlclxyXG5cdFx0biA9IDFcclxuXHRcdHdoaWxlIHRydWVcclxuXHRcdFx0Z3JvdXBzID0gW11cclxuXHRcdFx0Zm9yIGkgaW4gcmFuZ2UgbiBcclxuXHRcdFx0XHRncm91cHMucHVzaCBbMCxbXV0gIyB0b3RhbCBicmVkZCwgaW5kZXhlc1xyXG5cdFx0XHRmb3IgaSBpbiByYW5nZSB3aWR0aHMubGVuZ3RoIFxyXG5cdFx0XHRcdFt3LGluZGV4XSA9IHdpZHRoc1tpXVxyXG5cdFx0XHRcdGdyb3Vwc1swXVswXSArPSB3ICMgYnJlZGRlcm5hXHJcblx0XHRcdFx0Z3JvdXBzWzBdWzFdLnB1c2ggaW5kZXggIyBpbmRleGVuXHJcblx0XHRcdFx0Z3JvdXBzLnNvcnQoKSAjIHNvcnRlcmEgcMOlIGJyZWRkXHJcblx0XHRcdGxhc3QgPSBncm91cHNbZ3JvdXBzLmxlbmd0aC0xXSAjIGJyZWRhc3RlIGdydXBwZW5cclxuXHRcdFx0aWYgbGFzdFswXSArIChsYXN0WzFdLmxlbmd0aC0xKSAqIHR3U0VQIDw9IGR3XHJcblx0XHRcdFx0cmV0dXJuIGdyb3Vwcy5tYXAgKGdyb3VwKSAtPiBncm91cFsxXSAjIHNraXBwYSBicmVkZGVybmFcclxuXHRcdFx0bisrXHJcbiJdfQ==
//# sourceURL=c:\github\2022-003-Bokmassan\coffee\TextScroller.coffee